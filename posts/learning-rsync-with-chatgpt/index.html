<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.3.1" /><meta property="og:title" content="Learning rsync with ChatGPT" /><meta property="og:locale" content="en" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://www.techbythenerd.com/posts/learning-rsync-with-chatgpt/" /><meta property="og:url" content="https://www.techbythenerd.com/posts/learning-rsync-with-chatgpt/" /><meta property="og:site_name" content="TechByTheNerd" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-13T21:15:00-05:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Learning rsync with ChatGPT" /><meta name="twitter:site" content="@techbythenerd" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-12-14T00:37:26-05:00","datePublished":"2022-12-13T21:15:00-05:00","description":"Overview","headline":"Learning rsync with ChatGPT","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.techbythenerd.com/posts/learning-rsync-with-chatgpt/"},"url":"https://www.techbythenerd.com/posts/learning-rsync-with-chatgpt/"}</script><title>Learning rsync with ChatGPT | TechByTheNerd</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="TechByTheNerd"><meta name="application-name" content="TechByTheNerd"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="https://avatars.githubusercontent.com/u/54506297?s=200&v=4" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">TechByTheNerd</a></div><div class="site-subtitle font-italic">Tech by a nerd, for the nerds.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/TechByTheNerd" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/techbythenerd" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['no-reply','techbythenerd.com?subject=Undeliverable.'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Learning rsync with ChatGPT</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Learning rsync with ChatGPT</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1670984100" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 13, 2022 </em> </span> <span> Updated <em class="" data-ts="1670996246" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Dec 14, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://twitter.com/username">TechByTheNerd</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1932 words"> <em>10 min</em> read</span></div></div></div><div class="post-content"><h2 id="overview"><span class="mr-2">Overview</span><a href="#overview" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>As people play around with ChatGPT, I’ve been seeing all sorts of reactions, and all sorts of things those people are trying. For me, one of the first places I gravitated to was to help me with some bash script. As I’ve dabbled in bash over the years, I’ve learned more and more little tricks. However, there were still some things I would get stuck on.</p><p>At the moment, I’m revamping how I do Linux backups. One of the things I’d like to figure out “once and for all” is how to <code class="language-plaintext highlighter-rouge">rsync</code> my backups off my server and get them to my NAS. I thought: this is a good time to see if ChatGPT has some ideas!</p><h3 id="tips-on-using-chatgpt"><span class="mr-2">Tips on using ChatGPT</span><a href="#tips-on-using-chatgpt" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>One of the really key elements of success, is to give it as much information as possible. If you just ask a superficial question, you’ll get a superficial answer. However, if you give it: machine names, user names, variable names, explain the logic that is needed - it will produce <em>really</em> high quality output. So, that is what I tried.</p><h3 id="asking-chatgpt-how-to-use-rsync-correctly"><span class="mr-2">Asking ChatGPT how to use <code class="language-plaintext highlighter-rouge">rsync</code> correctly</span><a href="#asking-chatgpt-how-to-use-rsync-correctly" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Below is my copy/pasted transcript of what I asked, and what it responded with. This is primarily to show that if you give it deep details, it will create <em>very</em> high quality responses. This short conversation gave me a lot of new information I didn’t know, and many new things to try, to solve my problem.</p><p>This isn’t about <code class="language-plaintext highlighter-rouge">rsync</code>, it’s about what questions I asked, and how it responded. Below is the exact transcript (typos and all):</p><hr /><blockquote class="prompt-info"><div><p>OK, so here’s the deal. I have a backup server named “archive”. On there, I have a non-priviledged account called “archiver”. On that server, I have a volume mounted on “/var/archive” which has like 20TB of space. I also created an SSH keypair for the archiver account.</p><p>From various other linux machines on the network, I would like to use rsync to push backup files to the archive machine, using this one SSH key, so there is no password prompt.</p><p>However, I since this SSH key will be available in a lot of places, I want to really restrict it. Can I make it so when remote systems log in to archiver@archive, all they can do is rsync push files, and nothing else? They shouldn’t be able to change directories, get a bash shell, and if they used the key with ssh or scp, they should not be able to do anything, to work with any files. I want this archiver account to only be able to be used by remote machines to push files to “archive” and no have any other permissions.</p><p>How would I need to configure my archiver@archive account, in terms of changing it’s shell perhaps, or changing permissions? For example, I would going to create a soft link in the home directory of archive for “ln -s /var/archive/ ~/archive” and try to give it write-only access? Will that work?</p><p>What’s the correct way to set this up?</p></div></blockquote><p>To restrict the archiver account to only allow rsync push commands, you can do the following:</p><p>On the archive server, log in to the archiver account and create a new directory where the files will be pushed. For example, you could create a directory called “backups” in the home directory of the archiver account, like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir </span>backups
</pre></table></code></div></div><p>Set the permissions on the backups directory so that it is write-only for the archiver account. This will prevent the archiver account from being able to read or execute any files in the backups directory. You can do this by running the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">chmod </span>700 backups
</pre></table></code></div></div><p>Edit the <code class="language-plaintext highlighter-rouge">.ssh/authorized_keys</code> file for the archiver account and add the following restricted command to the end of the key that you want to use:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">command</span><span class="o">=</span><span class="s2">"rsync --server --sender -logDtpre.iLsf --numeric-ids . /backups"</span> ssh-rsa <span class="o">[</span>SSH KEY HERE]
</pre></table></code></div></div><p>This will allow the archiver account to only execute the rsync command with the specified options. Any other commands that are attempted, including logging in with ssh or using scp, will be denied.</p><p>To create the soft link, you can run the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">ln</span> <span class="nt">-s</span> /var/archive/ ~/archive
</pre></table></code></div></div><p>This will create a symbolic link in the home directory of the archiver account that points to the <code class="language-plaintext highlighter-rouge">/var/archive</code> directory. You can then use this link when specifying the destination for rsync commands from remote machines.</p><p>Keep in mind that you may need to adjust the permissions on the <code class="language-plaintext highlighter-rouge">/var/archive directory</code> to allow the archiver account to write to it. You can do this by running the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">chmod </span>g+w /var/archive
</pre></table></code></div></div><p>This will add write permissions for the group that the archiver account belongs to.</p><p>I hope this helps! Let me know if you have any other questions.</p><blockquote class="prompt-info"><div><p>OK, and then from “test-server”, what would be the rsync command to push “backup.tar.gz.gpg” to that server. Doesn’t rsync want to read the directory contents first? Do I need to tell rsync to not try to “read” anything, and to JUST write?</p></div></blockquote><p>To push a file called “backup.tar.gz.gpg” to the archive server using rsync, you can use the following command on the test-server:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-e</span> ssh <span class="nt">-avz</span> backup.tar.gz.gpg archiver@archive:~/archive
</pre></table></code></div></div><p>This command will use ssh to connect to the archiver account on the archive server, and will then use rsync to push the “backup.tar.gz.gpg” file to the <code class="language-plaintext highlighter-rouge">/var/archive</code> directory on the archive server, using the symbolic link that you created.</p><p>The -e ssh option specifies that ssh should be used for the transport, the -avz options are rsync options that enable archive mode, verbose output, and compression, and the final argument specifies the source file and the destination on the remote server.</p><p>Since the archiver account has write-only permissions on the <code class="language-plaintext highlighter-rouge">/var/archive</code> directory, it will not be able to read the contents of the directory. This means that rsync will not try to read the directory contents before transferring the file. It will simply transfer the file and then exit.</p><p>I hope this helps! Let me know if you have any other questions.</p><blockquote class="prompt-info"><div><p>One more thing: could you please modify the command about and show how I might use archiver_id.key as my SSH key whilst connecting as archiver@archive?</p></div></blockquote><p>To use a specific SSH key when connecting to the archiver account on the archive server, you can use the -i option with ssh, like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-e</span> <span class="s2">"ssh -i archiver_id.key"</span> <span class="nt">-avz</span> backup.tar.gz.gpg archiver@archive:~/archive
</pre></table></code></div></div><p>This will use the <code class="language-plaintext highlighter-rouge">archiver_id.key</code> file as the SSH key for the connection.</p><p>You can also specify the SSH key in the ssh_config file on the test-server, which will allow you to use the ssh command without the -i option. To do this, add the following lines to the ssh_config file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>Host archive
  Hostname <span class="o">[</span>SERVER HOSTNAME]
  User archiver
  IdentityFile /path/to/archiver_id.key
</pre></table></code></div></div><p>Replace <code class="language-plaintext highlighter-rouge">[SERVER HOSTNAME]</code> with the hostname of the archive server.</p><p>You can then use the following rsync command to push the file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-e</span> ssh <span class="nt">-avz</span> backup.tar.gz.gpg archiver@archive:~/archive
</pre></table></code></div></div><p>This will use the settings from the ssh_config file to connect to the archiver account on the archive server using the specified SSH key.</p><p>I hope this helps! Let me know if you have any other questions.</p><blockquote class="prompt-info"><div><p>Can I make it so I can rsync as archiver@archive without using any authentication?</p></div></blockquote><p>If you want to use rsync to transfer files to the archiver account on the archive server without using any authentication, you can use rsync’s built-in “daemon” mode. In this mode, rsync will listen on a specified port for incoming connections, and will allow clients to transfer files without requiring any authentication.</p><p>To use this mode, you can start the rsync daemon on the archive server by running the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">--daemon</span> <span class="nt">--no-detach</span> <span class="nt">--log-file</span> /var/log/rsyncd.log
</pre></table></code></div></div><p>This will start the rsync daemon in the foreground, logging output to the specified log file. The –no-detach option is included so that you can easily stop the daemon by pressing Ctrl+C.</p><p>Once the daemon is running, you can use the following rsync command on the test-server to transfer a file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-avz</span> backup.tar.gz.gpg rsync://archive/backups
</pre></table></code></div></div><p>This will use rsync to connect to the rsync daemon on the archive server and transfer the “backup.tar.gz.gpg” file to the <code class="language-plaintext highlighter-rouge">/var/archive/backups</code> directory on the archive server.</p><p>Keep in mind that using the rsync daemon in this way is not very secure, since it does not require any authentication. You should only use this method if the archive server is on a secure, trusted network and if you are confident that no unauthorized users will be able to access it.</p><p>I hope this helps! Let me know if you have any other questions.</p><blockquote class="prompt-info"><div><p>But wait, could I also still do the write-only method we discussed earlier? In other words, this technique wouldn’t be too dangerous if all this “archiver” account can do, is blindly drop files into a write-only folder, and it would not be possible to get to a shell, right?</p><p>Can I still do write-only with this technique?</p></div></blockquote><p>Yes, you can still use the write-only technique that we discussed earlier when using the rsync daemon in this way. To do this, you would need to add the following lines to the /etc/rsyncd.conf file on the archive server:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">[</span>backups]
    path <span class="o">=</span> /var/archive/backups
    <span class="nb">read </span>only <span class="o">=</span> <span class="nb">false
    </span>write only <span class="o">=</span> <span class="nb">true
    </span>uid <span class="o">=</span> archiver
</pre></table></code></div></div><p>This will configure the rsync daemon to only allow write operations to the <code class="language-plaintext highlighter-rouge">/var/archive/backups</code> directory, and to run all operations as the archiver user. This will prevent clients from being able to read or execute any files in the backups directory.</p><p>Once you have added these lines to the rsyncd.conf file, you can restart the rsync daemon by running the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">--daemon</span> <span class="nt">--no-detach</span> <span class="nt">--log-file</span> /var/log/rsyncd.log
</pre></table></code></div></div><p>You can then use the following rsync command on the test-server to transfer a file:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-avz</span> backup.tar.gz.gpg rsync://archive/backups
</pre></table></code></div></div><p>This will transfer the “backup.tar.gz.gpg” file to the <code class="language-plaintext highlighter-rouge">/var/archive/backups</code> directory on the archive server, using the write-only permissions that you configured.</p><p>As long as you have set the write-only permissions on the backups directory and have configured the rsync daemon to run as the archiver user, it will not be possible for clients to get a shell or to perform any other operations on the server.</p><p>I hope this helps! Let me know if you have any other questions.</p><blockquote class="prompt-info"><div><p>One last question: how can I have this rsync-daemon run on a different port? What do I need to configure on the server, and where do I specify the port syntax from the client?</p></div></blockquote><p>To configure the rsync daemon to listen on a different port, you can add the following line to the <code class="language-plaintext highlighter-rouge">/etc/rsyncd.conf</code> file on the archive server:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>port <span class="o">=</span> <span class="o">[</span>PORT NUMBER]
</pre></table></code></div></div><p>Replace <code class="language-plaintext highlighter-rouge">[PORT NUMBER]</code> with the port number that you want the rsync daemon to listen on. For example, if you want the rsync daemon to listen on port 873, you would use the following line:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>port <span class="o">=</span> 873
</pre></table></code></div></div><p>Once you have added this line to the rsyncd.conf file, you can restart the rsync daemon by running the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">--daemon</span> <span class="nt">--no-detach</span> <span class="nt">--log-file</span> /var/log/rsyncd.log
</pre></table></code></div></div><p>To specify the port number when connecting to the rsync daemon from the test-server, you can use the -p option with rsync, like this:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>rsync <span class="nt">-avz</span> <span class="nt">-p873</span> backup.tar.gz.gpg rsync://archive/backups
</pre></table></code></div></div><p>This will use rsync to connect to the rsync daemon on the archive server using port 873, and will transfer the “backup.tar.gz.gpg” file to the /var/archive/backups directory on the archive server.</p><p>I hope this helps! Let me know if you have any other questions.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/education/'>education</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/education/" class="post-tag no-text-decoration" >education</a> <a href="/tags/chatgpt/" class="post-tag no-text-decoration" >chatgpt</a> <a href="/tags/backups/" class="post-tag no-text-decoration" >backups</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Learning+rsync+with+ChatGPT+-+TechByTheNerd&url=https%3A%2F%2Fwww.techbythenerd.com%2Fposts%2Flearning-rsync-with-chatgpt%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Learning+rsync+with+ChatGPT+-+TechByTheNerd&u=https%3A%2F%2Fwww.techbythenerd.com%2Fposts%2Flearning-rsync-with-chatgpt%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fwww.techbythenerd.com%2Fposts%2Flearning-rsync-with-chatgpt%2F&text=Learning+rsync+with+ChatGPT+-+TechByTheNerd" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/learning-rsync-with-chatgpt/">Learning rsync with ChatGPT</a><li><a href="/posts/expanding-disk-volumes-on-ubuntu/">Expanding Disk Volumes on Ubuntu</a><li><a href="/posts/virtualbox-guest-additions/">VirtualBox Guest Additions</a><li><a href="/posts/installing-ubuntu-into-virtualbox-on-non-m1-macos/">Installing Ubuntu into VirtualBox on (non-M1) macOS</a><li><a href="/posts/patching-and-updating-ubuntu/">Patching and Updating Ubuntu</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/infrastructure/">infrastructure</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/virtualization/">virtualization</a> <a class="post-tag" href="/tags/virtualbox/">virtualbox</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/techno-tim/">techno-tim</a> <a class="post-tag" href="/tags/backups/">backups</a> <a class="post-tag" href="/tags/centos/">centos</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/expanding-disk-volumes-on-ubuntu/"><div class="card-body"> <em class="small" data-ts="1670207520" data-df="ll" > Dec 4, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Expanding Disk Volumes on Ubuntu</h3><div class="text-muted small"><p> Overview There are times when you need to expand the size of a disk or volume in a virtualized environment, and you’d ideally want to do that without having to move or copy files. This page shows ...</p></div></div></a></div><div class="card"> <a href="/posts/virtualbox-guest-additions/"><div class="card-body"> <em class="small" data-ts="1654817760" data-df="ll" > Jun 9, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>VirtualBox Guest Additions</h3><div class="text-muted small"><p> Overview A key part of using VirtualBox is knowing that there is technology like the “VirtualBox Guest Additions”. What this is, are libraries and drivers that tell the hosted operating system, th...</p></div></div></a></div><div class="card"> <a href="/posts/installing-ubuntu-into-virtualbox-on-windows11/"><div class="card-body"> <em class="small" data-ts="1654572960" data-df="ll" > Jun 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Installing Ubuntu into VirtualBox on Windows 11</h3><div class="text-muted small"><p> Overview Suppose you want to play around with Linux and maybe you’ve heard people talking about Ubuntu. But you don’t have an extra computer laying around to try it, and you certainly don’t want t...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/expanding-disk-volumes-on-ubuntu/" class="btn btn-outline-primary" prompt="Older"><p>Expanding Disk Volumes on Ubuntu</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/homelab/">homelab</a> <a class="post-tag" href="/tags/infrastructure/">infrastructure</a> <a class="post-tag" href="/tags/ubuntu/">ubuntu</a> <a class="post-tag" href="/tags/virtualization/">virtualization</a> <a class="post-tag" href="/tags/virtualbox/">virtualbox</a> <a class="post-tag" href="/tags/proxmox/">proxmox</a> <a class="post-tag" href="/tags/security/">security</a> <a class="post-tag" href="/tags/techno-tim/">techno-tim</a> <a class="post-tag" href="/tags/backups/">backups</a> <a class="post-tag" href="/tags/centos/">centos</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">TechByTheNerd</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
